<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head><link rel=manifest href=/manifest.json><meta name="generator" content="Hexo 3.9.0"><link rel="manifest" href="/manifest.json">
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.6 -->
    <script>
        window.materialVersion = "1.5.6"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1',
            '1.5.0',
            '1.5.2',
            '1.5.5'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">



    <link rel="dns-prefetch" href="https://busuanzi.ibruce.info">





    <link rel="dns-prefetch" href="https://www.google-analytics.com">



    <link rel="dns-prefetch" href="https://fonts.googleapis.com">





    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- Title -->
    
    <title>
        
            彻底搞懂ajax | 
        
        simmyo_z的博客
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" href="/img/favicon.png">

    <meta name="format-detection" content="telephone=no">
    <meta name="description" itemprop="description" content>
    <meta name="keywords" content="blog 前端 javascript 算法 日志 css html,html5">
    <meta name="theme-color" content="#0097A7">

    <!-- Disable Fucking Bloody Baidu Tranformation -->
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta http-equiv="Cache-Control" content="no-siteapp">

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(a){try{localStorage.removeItem(a)}catch(b){}};lsloader.setLS=function(a,c){try{localStorage.setItem(a,c)}catch(b){}};lsloader.getLS=function(a){var c="";try{c=localStorage.getItem(a)}catch(b){c=""}return c};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var b=[];for(var a=0;a<localStorage.length;a++){b.push(localStorage.key(a))}b.forEach(function(e){var f=lsloader.getLS(e);if(window.oldVersion){var d=window.oldVersion.reduce(function(g,h){return g||f.indexOf("/*"+h+"*/")!==-1},false);if(d){lsloader.removeLS(e)}}})}catch(c){}};lsloader.clean();lsloader.load=function(f,a,b,d){if(typeof b==="boolean"){d=b;b=undefined}d=d||false;b=b||function(){};var e;e=this.getLS(f);if(e&&e.indexOf(versionString)===-1){this.removeLS(f);this.requestResource(f,a,b,d);return}if(e){var c=e.split(versionString)[0];if(c!=a){console.log("reload:"+a);this.removeLS(f);this.requestResource(f,a,b,d);return}e=e.split(versionString)[1];if(d){this.jsRunSequence.push({name:f,code:e});this.runjs(a,f,e)}else{document.getElementById(f).appendChild(document.createTextNode(e));b()}}else{this.requestResource(f,a,b,d)}};lsloader.requestResource=function(b,e,a,c){var d=this;if(c){this.iojs(e,b,function(h,f,g){d.setLS(f,h+versionString+g);d.runjs(h,f,g)})}else{this.iocss(e,b,function(f){document.getElementById(b).appendChild(document.createTextNode(f));d.setLS(b,e+versionString+f)},a)}};lsloader.iojs=function(d,b,g){var a=this;a.jsRunSequence.push({name:b,code:""});try{var f=new XMLHttpRequest();f.open("get",d,true);f.onreadystatechange=function(){if(f.readyState==4){if((f.status>=200&&f.status<300)||f.status==304){if(f.response!=""){g(d,b,f.response);return}}a.jsfallback(d,b)}};f.send(null)}catch(c){a.jsfallback(d,b)}};lsloader.iocss=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.iofonts=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.runjs=function(f,c,e){if(!!c&&!!e){for(var b in this.jsRunSequence){if(this.jsRunSequence[b].name==c){this.jsRunSequence[b].code=e}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var a=document.createElement("script");a.appendChild(document.createTextNode(this.jsRunSequence[0].code));a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else{if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var d=this;var a=document.createElement("script");a.src=this.jsRunSequence[0].path;a.type="text/javascript";this.jsRunSequence[0].status="loading";a.onload=function(){d.jsRunSequence.shift();if(d.jsRunSequence.length>0){d.runjs()}};document.body.appendChild(a)}}};lsloader.tagLoad=function(b,a){this.jsRunSequence.push({name:a,code:"",path:b,status:"failed"});this.runjs()};lsloader.jsfallback=function(c,b){if(!!this.jsnamemap[b]){return}else{this.jsnamemap[b]=b}for(var a in this.jsRunSequence){if(this.jsRunSequence[a].name==b){this.jsRunSequence[a].code="";this.jsRunSequence[a].status="failed";this.jsRunSequence[a].path=c}}this.runjs()};lsloader.cssfallback=function(e,c,b){if(!!this.cssnamemap[c]){return}else{this.cssnamemap[c]=1}var d=document.createElement("link");d.type="text/css";d.href=e;d.rel="stylesheet";d.onload=d.onerror=b;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(d,a)};lsloader.runInlineScript=function(c,b){var a=document.getElementById(b).innerText;this.jsRunSequence.push({name:c,code:a});this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?uVzgA6RLrOm13Ukw8Qgy+A==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        
            
                <style id="prettify_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_css","/css/prettify.min.css?zp8STOU9v89XWFEnN+6YmQ==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
                <style id="prettify_theme"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_theme","/css/prettify/github-v2.min.css?AfzKxt++K+/lhZBlSjnxwg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
            
        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icons -->


    <style id="material_icons"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_icons","/css/material-icons.css?pqhB/Rd/ab0H2+kZp0RDmw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?ezyEvm8ST5CGfpA+kFFi1g==", true)</script>
    

    <!-- WebAPP Icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="simmyo_z的博客">
    <meta name="msapplication-starturl" content="https://zzz1220.github.io/posts/e9a05528/">
    <meta name="msapplication-navbutton-color" content="#0097A7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="simmyo_z的博客">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="https://zzz1220.github.io/posts/e9a05528/">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="彻底搞懂ajax | simmyo_z的博客">
    <meta property="og:image" content="/img/favicon.png">
    <meta property="og:description" content>
    <meta property="og:article:tag" content="html5"> 

    
        <meta property="article:published_time" content="Fri Apr 19 2019 13:47:11 GMT+0800">
        <meta property="article:modified_time" content="Tue Nov 07 2023 14:53:35 GMT+0800">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:card" content="summary_large_image">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="https://zzz1220.github.io/posts/e9a05528/index.html">
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "https://zzz1220.github.io/posts/e9a05528/index.html",
    "headline": "彻底搞懂ajax",
    "datePublished": "Fri Apr 19 2019 13:47:11 GMT+0800",
    "dateModified": "Tue Nov 07 2023 14:53:35 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "zzz1220",
        "image": {
            "@type": "ImageObject",
            "url": "/img/avatar.jpeg"
        },
        "description": "programer, js, ts, react, vue"
    },
    "publisher": {
        "@type": "Organization",
        "name": "simmyo_z的博客",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.png"
        }
    },
    "keywords": ",html5blog 前端 javascript 算法 日志 css html",
    "description": "",
}
</script>


    

    <!-- Analytics -->
    
        <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-145111272-1', 'auto');ga('send', 'pageview');
</script>
    
    
    

    <!-- Custom Head -->
    

</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span id="MD-burger-id" class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-Ajax其实是标准"><span class="post-toc-number">1.</span> <span class="post-toc-text">¶1.Ajax其实是标准</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ajax技术发展史"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">¶ajax技术发展史</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-XMLHttpRequest介绍"><span class="post-toc-number">2.</span> <span class="post-toc-text">¶2.XMLHttpRequest介绍</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-使用XMLHttpRequest"><span class="post-toc-number">3.</span> <span class="post-toc-text">¶3.使用XMLHttpRequest</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#open"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">¶open()`</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#setRequestHeader"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">¶setRequestHeader()</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#send"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">¶send()</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#设置request-header"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">¶设置request header</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#获取Response-Header"><span class="post-toc-number">3.5.</span> <span class="post-toc-text">¶获取Response Header</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#指定返回的数据类型"><span class="post-toc-number">3.6.</span> <span class="post-toc-text">¶指定返回的数据类型</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#追踪ajax-的当前状态"><span class="post-toc-number">3.7.</span> <span class="post-toc-text">¶追踪ajax 的当前状态</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#设置超时时间"><span class="post-toc-number">3.8.</span> <span class="post-toc-text">¶设置超时时间</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#同步请求"><span class="post-toc-number">3.9.</span> <span class="post-toc-text">¶同步请求</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#显示进度"><span class="post-toc-number">3.10.</span> <span class="post-toc-text">¶显示进度</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#send-data-的参数"><span class="post-toc-number">3.11.</span> <span class="post-toc-text">¶send(data)的参数</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-ajax和js单线程机制"><span class="post-toc-number">4.</span> <span class="post-toc-text">¶4.ajax和js单线程机制</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-ajax和跨域"><span class="post-toc-number">5.</span> <span class="post-toc-text">¶5.ajax和跨域</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#6-fetch-api"><span class="post-toc-number">6.</span> <span class="post-toc-text">¶6.fetch api</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-Axios使用"><span class="post-toc-number">7.</span> <span class="post-toc-text">¶7.Axios使用</span></a></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 42 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                彻底搞懂ajax
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.jpeg" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>zzz1220</strong>
        <span>4月 19, 2019</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    
        <button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">devices other</i>
    <span class="visuallyhidden">devices other</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button">
    <li class="mdl-menu__item">在其它设备中阅读本文章</li>
    
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACXUlEQVR42u3ay47CMBAEQP7/p3evKyGWbjseIlQ5IfGIy4fM0J7Hz1dfDzw8PDw8PDw8vJvxHvH1/K2XN/jz7vPr/F6La8PDw8Mb4b151Ja858Ul1P+3plgbHh4e3iAvv+VVy0oKQ35fPDw8vPvzrionyTbh4eHhfRMvCRHywrCzNjw8PLx5XhvL5p9JwLfIWvDw8PBiXnsoNfl69HwPDw8PL+DVI01xa5sv9+DQFR4eHt4BXv4gzoPand9sD8nw8PDwPsXLg9Q2kF0bS203Cw8PD2+St/O3/0Rp2Y938fDw8E7z8ofy/2302tFX/mvFluHh4eGN8PJQII8kknfzUlEEx3h4eHgjvNOjV23Y0Q684uHh4U3yksduPnqVN9M7LXjRUuPh4eEd461d9SBpuWXJaAIeHh7ePC9fVjs6sFZIcurL0oKHh4c3yEua7HYL1n6hHcPCw8PDm+StHdKvhQU7JaEoFXh4eHiHefkx/07QkAfHbcGI6h4eHh7epbyrjrjyw62do7JoO/Dw8PAO89bGBdpWuB3AagMOPDw8vM/y1oLUvI1eOxIrSggeHh7eIC+5wdr4VN6Ot98tCgMeHh7eIC9vr9tCkge1SeHBw8PDm+G111rrvDOO0LbjeHh4eKd5a4/jpAy0mLw1f7O5eHh4eCO8pBjkzfSJUa0LZsrw8PDwDvCS6GFnpCD//JGsBQ8PD+82vP1We38L8PDw8O7Py+ODNvZtG/EjhQEPDw/v0pxzJ/xtAR+IcfHw8PAOHIC1Met+RNsi8fDw8E7zvu/Cw8PDw8PDw8O7wfULgF33E/omxfkAAAAASUVORK5CYII=">
    
</ul>

    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/html5/">html5</a>
    </ul>
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    
        
            <!-- Busuanzi Views -->
            <a class="post_share-link" href="#">
                <li class="mdl-menu__item">
                    <span id="busuanzi_container_page_pv">
                        <span id="busuanzi_value_page_pv"></span>&nbsp;浏览量
                    </span>
                </li>
            </a>
        
    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=彻底搞懂ajax&url=https://zzz1220.github.io/posts/e9a05528/index.html&pic=https://zzz1220.github.io/img/favicon.png&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=彻底搞懂ajax&url=https://zzz1220.github.io/posts/e9a05528/index.html&via=zzz1220" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=https://zzz1220.github.io/posts/e9a05528/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=https://zzz1220.github.io/posts/e9a05528/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    
        <a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=simmyo_z的博客&title=彻底搞懂ajax&summary=&pics=https://zzz1220.github.io/img/favicon.png&url=https://zzz1220.github.io/posts/e9a05528/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 QQ
            </li>
        </a>
    

    <!-- Share Telegram -->
    
</ul>

    
</div>
<div style="padding-left:3rem;font-size: 1rem;">
    👉👉本文共<span class="post-count">5.3k</span>字📘
    读完共需<span class="post-count">21</span>分钟⌚
</div>
                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <blockquote>
<p>每个会用<code>jquery</code>的人都会用<code>$.ajax</code>发起一个<code>ajax</code>请求，然后再回调函数里面取得返回的数据，但是并不是所有的人都知道这个流程里面发生了什么事，本文就深入讨论下关于<code>ajax</code>的所有（大部分）细节。</p>
</blockquote>
<p>[TOC]</p>
<h3 id="1-Ajax其实是标准"><a class="header-anchor" href="#1-Ajax其实是标准">¶</a>1.Ajax其实是标准</h3>
<p>很多人误以为<code>XMLHttpRequest</code>就是<code>Ajax</code>，其实不然，他们两个是两个不同维度的概念。</p>
<p>搜索<code>ajax</code>的<code>wiki</code>，是这样介绍的：</p>
<blockquote>
<p><strong>AJAX</strong>即“<strong>Asynchronous JavaScript and XML</strong>”（异步的<a href="https://zh.wikipedia.org/wiki/JavaScript">JavaScript</a>与<a href="https://zh.wikipedia.org/wiki/XML">XML</a>技术），指的是一套综合了多项技术的<a href="https://zh.wikipedia.org/wiki/%E7%80%8F%E8%A6%BD%E5%99%A8">浏览器</a>端<a href="https://zh.wikipedia.org/wiki/%E7%B6%B2%E9%A0%81">网页</a>开发技术。Ajax的概念由<a href="https://zh.wikipedia.org/wiki/%E5%82%91%E8%A5%BF%C2%B7%E8%A9%B9%E5%A7%86%E5%A3%AB%C2%B7%E8%B3%88%E7%91%9E%E7%89%B9">杰西·詹姆士·贾瑞特</a>所提出。</p>
</blockquote>
<h4 id="ajax技术发展史"><a class="header-anchor" href="#ajax技术发展史">¶</a>ajax技术发展史</h4>
<p>​        上个世纪90年代，几乎所有的网站都由HTML页面实现，服务器处理每一个用户请求都需要重新加载网页。这样的处理方式效率不高。用户的体验是所有页面都会消失，再重新加载，即使只是一部分页面元素改变也要重新加载整个页面，不仅要刷新改变的部分，连没有变化的部分也要刷新。这会加重服务器的负担。</p>
<p>​        这可以用<a href="https://zh.wikipedia.org/wiki/%E7%95%B0%E6%AD%A5">异步</a>加载来解决。1995年，JAVA语言的第一版发布，随之发布的的Java applets（JAVA小程序）首次实现了异步加载。浏览器通过运行嵌入网页中的Java applets与服务器交换数据，不必刷新网页。1996年，Internet Explorer将iframe元素加入到HTML，支持局部刷新网页。</p>
<p>​        1998年前后，Outlook Web Access小组写成了允许<a href="https://zh.wikipedia.org/w/index.php?title=%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%84%9A%E6%9C%AC&amp;action=edit&amp;redlink=1">客户端脚本</a>发送HTTP请求（<a href="https://zh.wikipedia.org/wiki/XMLHTTP">XMLHTTP</a>）的第一个组件。该组件原属于微软Exchange Server，并且迅速地成为了Internet Explorer 4.0[<a href="https://zh.wikipedia.org/wiki/AJAX#cite_note-2">2]</a>的一部分。部分观察家认为，Outlook Web Access是第一个应用了Ajax技术的成功的商业应用程序，并成为包括Oddpost的网络邮件产品在内的许多产品的领头羊。但是，2005年初，许多事件使得Ajax被大众所接受。<a href="https://zh.wikipedia.org/wiki/Google">Google</a>在它著名的交互应用程序中使用了异步通讯，如<a href="https://zh.wikipedia.org/w/index.php?title=Google%E8%AE%A8%E8%AE%BA%E7%BB%84&amp;action=edit&amp;redlink=1">Google讨论组</a>、<a href="https://zh.wikipedia.org/wiki/Google%E5%9C%B0%E5%9B%BE">Google地图</a>、<a href="https://zh.wikipedia.org/w/index.php?title=Google%E6%90%9C%E7%B4%A2%E5%BB%BA%E8%AE%AE&amp;action=edit&amp;redlink=1">Google搜索建议</a>、<a href="https://zh.wikipedia.org/wiki/Gmail">Gmail</a>等。Ajax这个词由《<em>Ajax: A New Approach to Web Applications</em>》一文所创，该文的迅速流传提高了人们使用该项技术的意识。另外，对Mozilla/Gecko的支持使得该技术走向成熟，变得更为简单易用。</p>
<p>​        所以<code>ajax</code>是一种技术方案，<code>XMLHttpRequest</code>是<code>ajax</code>在web端实现所依赖的一个对象，是这个对象使得浏览器可以发出<code>HTTP</code>请求与接收<code>HTTP</code>响应，来异步的操作网页。</p>
<p>​        只是现在，市面上基本都用<code>XMLHttpRequest</code> 来发送<code>ajax</code>请求。</p>
<p>​        <code>es6</code>新增了<code>fetch</code>来代替<code>XMLHttpRequest</code> ,比起<code>XMLHttpRequest</code>具有更好的可扩展性和高效性，下文会详细介绍。</p>
<p>​</p>
<h3 id="2-XMLHttpRequest介绍"><a class="header-anchor" href="#2-XMLHttpRequest介绍">¶</a>2.<code>XMLHttpRequest</code>介绍</h3>
<blockquote>
<p>​       <strong>XMLHTTP</strong>是一组<a href="https://zh.wikipedia.org/wiki/API">API</a>函数集，可被<a href="https://zh.wikipedia.org/wiki/JavaScript">JavaScript</a>、JScript、<a href="https://zh.wikipedia.org/wiki/VBScript">VBScript</a>以及其它<a href="https://zh.wikipedia.org/wiki/Web%E6%B5%8F%E8%A7%88%E5%99%A8">web浏览器</a>内嵌的<a href="https://zh.wikipedia.org/wiki/%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80">脚本语言</a>调用，通过<a href="https://zh.wikipedia.org/wiki/HTTP">HTTP</a>在浏览器和<a href="https://zh.wikipedia.org/wiki/Web%E6%9C%8D%E5%8A%A1%E5%99%A8">web服务器</a>之间收发<a href="https://zh.wikipedia.org/wiki/XML">XML</a>或其它数据。XMLHTTP最大的好处在于可以动态地更新网页，它无需重新从服务器读取整个网页，也不需要安装额外的插件。该技术被许多网站使用，以实现快速响应的动态网页应用。例如：<a href="https://zh.wikipedia.org/wiki/Google">Google</a>的<a href="https://zh.wikipedia.org/wiki/Gmail">Gmail</a>服务、Google Suggest动态查找界面以及<a href="https://zh.wikipedia.org/wiki/Google%E5%9C%B0%E5%9B%BE">Google Map</a>地理信息服务。</p>
</blockquote>
<p>​        一开始，巨硬公司发明了这个可以用来构造无刷新页面的对象，这个对象可以通过<code>javascript</code>,<code>VBScript</code>或者其他的浏览器内置脚本访问，后来其他的浏览器开发公司也逐步实现了这个标准对象，到了<code>dom3</code>标准时代，它已经成为<a href="https://zh.wikipedia.org/wiki/W3C">W3C</a>推荐的方法。截止2011年，大多数浏览器已经支持。互联网程序迎来了无刷新的页面时代，诞生了一大批优秀的<code>web</code>应用。</p>
<p>​		现代浏览器基本都支持<code>ajax</code>,但是他们的技术方案却分为两种：</p>
<p>​		标准浏览器通过 <code>XMLHttpRequest</code> 对象实现了ajax的功能. 只需要通过一行语句便可创建一个用于发送ajax请求的对象.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br></pre></td></tr></table></figure>
<p>​		IE浏览器通过<code>XMLHttpRequest</code>或者<code>ActiveXObject</code>对象同样实现了ajax的功能。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="title class_">ProgID</span>);</span><br><span class="line"><span class="comment">// progID可以是下面的值，对应不同的版本</span></span><br><span class="line"><span class="title class_">Microsoft</span>.<span class="property">XMLHTTP</span></span><br><span class="line"><span class="title class_">Microsoft</span>.<span class="property">XMLHTTP</span><span class="number">.1</span><span class="number">.0</span></span><br><span class="line"><span class="title class_">Msxml2</span>.<span class="property">ServerXMLHTTP</span></span><br><span class="line"><span class="title class_">Msxml2</span>.<span class="property">ServerXMLHTTP</span><span class="number">.3</span><span class="number">.0</span></span><br><span class="line"><span class="title class_">Msxml2</span>.<span class="property">ServerXMLHTTP</span><span class="number">.4</span><span class="number">.0</span></span><br><span class="line"><span class="title class_">Msxml2</span>.<span class="property">ServerXMLHTTP</span><span class="number">.5</span><span class="number">.0</span></span><br><span class="line"><span class="title class_">Msxml2</span>.<span class="property">ServerXMLHTTP</span><span class="number">.6</span><span class="number">.0</span></span><br><span class="line"><span class="title class_">Msxml2</span>.<span class="property">XMLHTTP</span></span><br><span class="line"><span class="title class_">Msxml2</span>.<span class="property">XMLHTTP</span><span class="number">.3</span><span class="number">.0</span></span><br><span class="line"><span class="title class_">Msxml2</span>.<span class="property">XMLHTTP</span><span class="number">.4</span><span class="number">.0</span></span><br><span class="line"><span class="title class_">Msxml2</span>.<span class="property">XMLHTTP</span><span class="number">.5</span><span class="number">.0</span></span><br><span class="line"><span class="title class_">Msxml2</span>.<span class="property">XMLHTTP</span><span class="number">.6</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>
<p>​		r如何取得全平台兼容的<code>XMLHttpRequest</code>对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getXHR</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> xhr = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable language_">window</span>.<span class="property">XMLHttpRequest</span>) &#123;</span><br><span class="line">    xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">ActiveXObject</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      xhr = <span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="string">&quot;Msxml2.XMLHTTP&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        xhr = <span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="string">&quot;Microsoft.XMLHTTP&quot;</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123; </span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;您的浏览器暂不支持Ajax!&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> xhr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​	<code>HTML 5</code>的概念形成后，<code>W3C</code>开始考虑标准化这个接口。2008年2月，就提出了<a href="http://dev.w3.org/2006/webapi/XMLHttpRequest-2/">XMLHttpRequest Level 2</a> 草案（之前是<code>Level 1</code>）。这个新版本提出了很多实用的功能，大大的加快了互联网革新。</p>
<p>​	<em>这里对比<code>level 1</code> 和 <code>level 2</code> 的区别</em></p>
<table>
<thead>
<tr>
<th>特性</th>
<th>level 1</th>
<th>level 2</th>
</tr>
</thead>
<tbody>
<tr>
<td>文本数据传送</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td>读取上传二进制</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>进度信息</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>同源限制</td>
<td>不支持跨域</td>
<td>可发送跨域请求</td>
</tr>
<tr>
<td>超时时间</td>
<td>不支持自己设置</td>
<td><code>xhr.timeout</code>设置超时时间</td>
</tr>
</tbody>
</table>
<p>​	此外，为了方便表单处理，<code>html5</code>新加了个<code>FormData</code>对象，新的标准同样支持这个对象，用来模拟表单。</p>
<p>关于<code>level 1</code> 和 <code>level 2</code>的区别，可也参考<a href="http://www.ruanyifeng.com/blog/2012/09/xmlhttprequest_level_2.html">XMLHttpRequest Level 2 使用指南</a>，阮老师对每个新特性都写了代码实例。</p>
<p><code>XMLHttpRequest</code>对象：</p>
<p>属性：</p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/channel"><code>channel</code></a> 草案，不知道是啥<br>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/mozAnon"><code>mozAnon</code></a><br>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/mozBackgroundRequest"><code>mozBackgroundRequest</code></a>草案，布尔值，为True 时，本次请求不带cookies或者头部认证信息<br>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/mozResponseArrayBuffer"><code>mozResponseArrayBuffer</code></a> 草案<br>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/mozSystem"><code>mozSystem</code></a> 草案<br>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/multipart"><code>multipart</code></a> 草案<br>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/onreadystatechange"><code>onreadystatechange</code></a> 只要``readyState` 发生改变，就调用这个函数。</p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/readyState"><code>readyState</code></a> 当前的状态，分别是0:UNSENT,1:OPENED,2:HEADERS_RECEIVED,3:LOADING,4:DONE。在ie里，状态名称不一样。<br>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/response"><code>response</code></a>请求响应的正文<br>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/responseText"><code>responseText</code></a> 返回一个DOMString，它包含对文本的请求的响应。<br>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/responseType"><code>responseType</code></a> 返回数据的类型，具体见下文<br>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/responseURL"><code>responseURL</code></a> 返回响应的序列化URL或空字符串<br>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/responseXML"><code>responseXML</code></a> 返回一个包含请求检索的HTML或XML的<code>Document</code><br>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/status"><code>status</code></a> 响应的数字状态码，采用标准HTTP 状态码<br>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/statusText"><code>statusText</code></a> 状态码对应的文本信息<br>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/timeout"><code>timeout</code></a> 超时时间<br>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/upload"><code>upload</code></a> 返回<br>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequestUpload"><code>XMLHttpRequestUpload</code></a> 对象，用来表示上传的进度<br>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/withCredentials"><code>withCredentials</code></a> 点击查看详情，和跨域请求认证有关</p>
<p>方法：</p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/abort"><code>abort()</code></a>终止请求，<code>readyState</code>会变为0<br>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/getAllResponseHeaders"><code>getAllResponseHeaders()</code></a>返回所有的响应头<br>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/getResponseHeader"><code>getResponseHeader()</code></a>返回指定的响应头<br>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/open"><code>open()</code></a>初始化一个请求。<br>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/overrideMimeType"><code>overrideMimeType()</code></a><code>level 1</code>的方法，用responseType代替</p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/send"><code>send()</code></a>发送http请求<br>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/sendAsBinary"><code>sendAsBinary()</code></a><br>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/setRequestHeader"><code>setRequestHeader()</code></a>设置http请求头</p>
<h3 id="3-使用XMLHttpRequest"><a class="header-anchor" href="#3-使用XMLHttpRequest">¶</a>3.使用<code>XMLHttpRequest</code></h3>
<p>下面是用 <code>XMLHttpRequest</code>发送<code>ajax</code>  <code>get</code> 请求的例子（用到了大部分<code>api</code>）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>(); <span class="comment">// 新建一个XMLHttpRequest对象实例</span></span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&#x27;get&#x27;</span>,<span class="string">&quot;url&quot;</span>); <span class="comment">// 设置请求方法和地址 </span></span><br><span class="line">xhr.<span class="property">responseType</span> = <span class="string">&quot;text&quot;</span>; <span class="comment">// 设置返回的数据类型</span></span><br><span class="line">xhr.<span class="property">timeout</span> = <span class="number">3000</span>; <span class="comment">// 设置超时时间</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 超时处理函数</span></span><br><span class="line">xhr.<span class="property">ontimeout</span> = <span class="keyword">function</span>(<span class="params">e</span>) &#123; </span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;timeout&quot;</span>)</span><br><span class="line">&#125;; </span><br><span class="line"><span class="comment">// 请求错误处理函数</span></span><br><span class="line">xhr.<span class="property">onerror</span> = <span class="keyword">function</span>(<span class="params">e</span>) &#123; </span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;error&quot;</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求进度处理函数</span></span><br><span class="line">xhr.<span class="property">upload</span>.<span class="property">onprogress</span> = <span class="keyword">function</span>(<span class="params">e</span>) &#123; </span><br><span class="line">	 <span class="keyword">if</span> (e.<span class="property">lengthComputable</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> completedPercent = e.<span class="property">loaded</span> / e.<span class="property">total</span>; <span class="comment">// 请求百分比</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 对completedPercent 操作</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 成功接收到请求的函数</span></span><br><span class="line">xhr.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">status</span> = <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">responseText</span>)；</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">xhr.<span class="title function_">send</span>(); <span class="comment">// 发送请求</span></span><br></pre></td></tr></table></figure>
<p>接下来，介绍一些常用的<code>api</code>：</p>
<p>更详细的可以看<code>mdn</code>的文档,里面有<code>XMLHttpRequest</code>对象所有的属性，方法。</p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest">XMLHttpRequest </a></p>
<h4 id="open"><a class="header-anchor" href="#open">¶</a>open()`</h4>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">XMLHttpRequest</span>.<span class="title function_">open</span>(method, url)</span><br><span class="line"><span class="title class_">XMLHttpRequest</span>.<span class="title function_">open</span>(method, url, <span class="keyword">async</span>)</span><br><span class="line"><span class="title class_">XMLHttpRequest</span>.<span class="title function_">open</span>(method, url, <span class="keyword">async</span>, user)</span><br><span class="line"><span class="title class_">XMLHttpRequest</span>.<span class="title function_">open</span>(method, url, <span class="keyword">async</span>, user, password)</span><br></pre></td></tr></table></figure>
<p><code>method</code> 就是需要使用的http方法，包括[GET],[POST],[PUT],[DELETE]等。</p>
<p><code>url</code>就是请求的地址<code>url</code>。</p>
<p><code>async</code> @可选 一个可选的布尔参数，默认为<code>true</code>，表示要不要异步执行操作。如果值为<code>false</code>，<code>send()</code>方法直到收到答复前不会返回。如果<code>true</code>，已完成事务的通知可供事件监听器使用。如果<code>multipart</code>属性为<code>true</code>则这个必须为<code>true</code>，否则将引发异常。</p>
<p><code>user</code>@ 可选 用户名用于认证用途；默认为<code>null</code>。</p>
<p><code>password</code> @可选 密码用于认证用途，默认为<code>null</code>。</p>
<h4 id="setRequestHeader"><a class="header-anchor" href="#setRequestHeader">¶</a><code>setRequestHeader()</code></h4>
<p>**<code>XMLHttpRequest.setRequestHeader()**</code> 是设置HTTP请求头部的方法。此方法必须在  <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/open"><code>open()</code></a>方法和 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/send"><code>send()</code></a>   之间调用。如果多次对同一个请求头赋值，只会生成一个合并了多个值的请求头。</p>
<h4 id="send"><a class="header-anchor" href="#send">¶</a>send()</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">void send();</span><br><span class="line">void send(ArrayBuffer data);</span><br><span class="line">void send(ArrayBufferView data);</span><br><span class="line">void send(Blob data);</span><br><span class="line">void send(Document data);</span><br><span class="line">void send(DOMString? data);</span><br><span class="line">void send(FormData data);</span><br></pre></td></tr></table></figure>
<p>​	方法用于发送 HTTP 请求。如果是异步请求（默认为异步请求），则此方法会在请求发送后立即返回；如果是同步请求，则此方法直到响应到达后才会返回。<code>XMLHttpRequest.send()</code> 方法接受一个可选的参数，其作为请求主体；如果请求方法是 GET 或者 HEAD，则应将请求主体设置为 null，此时参数应该在<code>url</code>后面。</p>
<p>😏 自定义一些header属性进行跨域请求时，可能会遇到&quot;<strong>not allowed by Access-Control-Allow-Headers in preflight response</strong>&quot;，你可能需要在你的服务端设置&quot;Access-Control-Allow-Headers&quot;。</p>
<p>接下来从一个完整的http请求流程介绍使用</p>
<h4 id="设置request-header"><a class="header-anchor" href="#设置request-header">¶</a>设置request header</h4>
<p>发送一个<code>http</code>请求之前，有时候我们需要设置一些请求头部信息。</p>
<p>比如常用的<code>cookie</code>,<code>content-type</code>等。</p>
<p>我们可以用<code>setRequestHeader(DOMString header, DOMString value)</code>这个函数设置。</p>
<ul>
<li>header大小写不明显，<code>cookie</code>和<code>Cookie</code>是等价的。</li>
<li><code>Content-Type</code>可以发送的数据类型可以看上面send函数的参数类型。</li>
<li>设置header 必须在<code>open</code> 和<code>send</code>之间，否则会报错。</li>
<li>这个函数可以调用多次，在<code>send</code>之前会合并多个调用设置的值。</li>
</ul>
<p>eg:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&#x27;get&#x27;</span>,<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line">xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&#x27;content-type&#x27;</span>,<span class="string">&#x27;multipart/form-data&#x27;</span>)</span><br><span class="line">xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&#x27;cookie&#x27;</span>,<span class="string">&#x27;asdaadfasdfasdfa&#x27;</span>)</span><br><span class="line"><span class="comment">// 上面设置后会合并两个header</span></span><br><span class="line">xhr.<span class="title function_">send</span>()</span><br></pre></td></tr></table></figure>
<h4 id="获取Response-Header"><a class="header-anchor" href="#获取Response-Header">¶</a>获取<code>Response Header</code></h4>
<p>获取<code>response header</code> 可以通过<code>getAllResponseHeaders()</code> 和<code>getResponseHeader(header)</code></p>
<p>从名字上可以看出来，一个是获取所有的header ，一个是获取指定的某个header 对应的值。</p>
<p><code>getResponseHeader(header)</code> 的参数不分大小写。</p>
<p>但是: 这里获取部分header 是有<strong>限制</strong>的，<strong>为了安全考虑</strong>，不管是不是同源都规定客户端无法获取<code>Set-Cookie</code>这个字段，在跨域的请求里，只能获取“<code>simple response header</code>”和“<code>Access-Control-Expose-Headers</code>”。</p>
<p>解释：</p>
<blockquote>
<p>&quot;<code>simple response header</code>&quot;包括的 header 字段有：<code>Cache-Control</code>,<code>Content-Language</code>,<code>Content-Type</code>,<code>Expires</code>,<code>Last-Modified</code>,<code>Pragma</code>;<br>
“<code>Access-Control-Expose-Headers</code>”：首先得注意是&quot;<code>Access-Control-Expose-Headers</code>&quot;进行<strong>跨域请求</strong>时响应头部中的一个字段，对于同域请求，响应头部是没有这个字段的。这个字段中列举的 header 字段就是服务器允许暴露给客户端访问的字段。</p>
</blockquote>
<p>eg:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xhr.<span class="title function_">getResponseHeader</span>(<span class="string">&#x27;Cache-Control&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="指定返回的数据类型"><a class="header-anchor" href="#指定返回的数据类型">¶</a>指定返回的数据类型</h4>
<p>用过<code>jquery</code>的<code>ajax</code>都知道里面有个属性<code>dataType</code>可以指定服务器返回的数据类型。</p>
<p>如果想通过<code>XMLHttpRequest</code>设置返回的数据类型，可以通过<code>xhr.responseType</code>属性来设置。<code>responseType</code>是<code>xhr level 2</code>新增的属性，用来指定<code>xhr.response</code>的数据类型，目前还存在些兼容性问题。</p>
<p><em>可以设置的值是：</em></p>
<table>
<thead>
<tr>
<th style="text-align:left">值</th>
<th style="text-align:left"><code>xhr.response</code> 数据类型</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>&quot;&quot;</code></td>
<td style="text-align:left"><code>String</code>字符串</td>
<td style="text-align:left">默认值(在不设置<code>responseType</code>时)</td>
</tr>
<tr>
<td style="text-align:left"><code>&quot;text&quot;</code></td>
<td style="text-align:left"><code>String</code>字符串</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left"><code>&quot;document&quot;</code></td>
<td style="text-align:left"><code>Document</code>对象</td>
<td style="text-align:left">希望返回 <code>XML</code> 格式数据时使用</td>
</tr>
<tr>
<td style="text-align:left"><code>&quot;json&quot;</code></td>
<td style="text-align:left"><code>javascript</code> 对象</td>
<td style="text-align:left">存在兼容性问题，IE10/IE11不支持</td>
</tr>
<tr>
<td style="text-align:left"><code>&quot;blob&quot;</code></td>
<td style="text-align:left"><code>Blob</code>对象</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left"><code>&quot;arrayBuffer&quot;</code></td>
<td style="text-align:left"><code>ArrayBuffer</code>对象</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<p>eg.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;/path/to/image.png&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">xhr.<span class="property">responseType</span> = <span class="string">&#x27;blob&#x27;</span></span><br><span class="line">xhr.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> == <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="comment">// 这里有三个可以获取返回值的属性，分别是 response，responseType responseXml </span></span><br><span class="line">        <span class="keyword">var</span> bloob = <span class="variable language_">this</span>.<span class="property">response</span>; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">xhr.<span class="title function_">send</span>()</span><br></pre></td></tr></table></figure>
<p>获取返回值：</p>
<ul>
<li><code>xhr.response</code>
<ul>
<li>默认值：空字符串<code>&quot;&quot;</code></li>
<li>当请求完成时，此属性才有正确的值</li>
<li>请求未完成时，此属性的值可能是<code>&quot;&quot;</code>或者 <code>null</code>，具体与 <code>xhr.responseType</code>有关：当<code>responseType</code>为<code>&quot;&quot;</code>或<code>&quot;text&quot;</code>时，值为<code>&quot;&quot;</code>；<code>responseType</code>为其他值时，值为 <code>null</code></li>
</ul>
</li>
<li><code>xhr.responseText</code>
<ul>
<li>默认值为空字符串<code>&quot;&quot;</code></li>
<li>只有当 <code>responseType</code> 为<code>&quot;text&quot;</code>、<code>&quot;&quot;</code>时，<code>xhr</code>对象上才有此属性，此时才能调用<code>xhr.responseText</code>，否则抛错</li>
<li>只有当请求成功时，才能拿到正确值。以下2种情况下值都为空字符串<code>&quot;&quot;</code>：请求未完成、请求失败</li>
</ul>
</li>
<li><code>xhr.responseXML</code>
<ul>
<li>默认值为 <code>null</code></li>
<li>只有当 <code>responseType</code> 为<code>&quot;text&quot;</code>、<code>&quot;&quot;</code>、<code>&quot;document&quot;</code>时，<code>xhr</code>对象上才有此属性，此时才能调用<code>xhr.responseXML</code>，否则抛错</li>
<li>只有当请求成功且返回数据被正确解析时，才能拿到正确值。以下3种情况下值都为<code>null</code>：请求未完成、请求失败、请求成功但返回数据无法被正确解析时</li>
</ul>
</li>
</ul>
<h4 id="追踪ajax-的当前状态"><a class="header-anchor" href="#追踪ajax-的当前状态">¶</a>追踪<code>ajax</code> 的当前状态</h4>
<p>上文已经说过了<code>XMLHttpRequest</code>有<code>readyState</code>状态，共有5种。</p>
<table>
<thead>
<tr>
<th>值</th>
<th>状态</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>0</code></td>
<td><code>UNSENT</code></td>
<td>代理被创建，但尚未调用 open() 方法。</td>
</tr>
<tr>
<td><code>1</code></td>
<td><code>OPENED</code></td>
<td><code>open()</code> 方法已经被调用。</td>
</tr>
<tr>
<td><code>2</code></td>
<td><code>HEADERS_RECEIVED</code></td>
<td><code>send()</code> 方法已经被调用，并且头部和状态已经可获得。</td>
</tr>
<tr>
<td><code>3</code></td>
<td><code>LOADING</code></td>
<td>下载中； <code>responseText</code> 属性已经包含部分数据。</td>
</tr>
<tr>
<td><code>4</code></td>
<td><code>DONE</code></td>
<td>下载操作已完成。</td>
</tr>
</tbody>
</table>
<p>状态改变的时候，会触发<code>onreadystatechange</code>事件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">switch</span>(xhr.<span class="property">readyState</span>)&#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:<span class="comment">//OPENED</span></span><br><span class="line">        <span class="comment">//do something</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:<span class="comment">//HEADERS_RECEIVED</span></span><br><span class="line">        <span class="comment">//do something</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:<span class="comment">//LOADING</span></span><br><span class="line">        <span class="comment">//do something</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:<span class="comment">//DONE</span></span><br><span class="line">        <span class="comment">//do something</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="设置超时时间"><a class="header-anchor" href="#设置超时时间">¶</a>设置超时时间</h4>
<p><code>timeout</code> 属性  单位 毫秒</p>
<p>如何计算时间？</p>
<p>开始时间指的是 <code>send</code>方法调用的时候</p>
<p>结束时间是<code>loadend</code>事件触发</p>
<p>😏注意在同步的请求里面，这个值必须设置为0.否则会报错。</p>
<h4 id="同步请求"><a class="header-anchor" href="#同步请求">¶</a>同步请求</h4>
<p>不建议发送同步请求</p>
<p>一定要发送的话</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">open</span>(method, url [, <span class="keyword">async</span> = <span class="literal">true</span> [, username = <span class="literal">null</span> [, password = <span class="literal">null</span>]]])</span><br><span class="line"><span class="comment">// async 设置为false</span></span><br></pre></td></tr></table></figure>
<h4 id="显示进度"><a class="header-anchor" href="#显示进度">¶</a>显示进度</h4>
<p>我们可以通过<code>onprogress</code>事件来实时显示进度，默认情况下这个事件每50ms触发一次。</p>
<p>但是，上传和下载，是不同对象的<code>onprogress</code>事件。</p>
<table>
<thead>
<tr>
<th>上传</th>
<th><code>xhr.upload</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>下载</td>
<td><code>xhr</code></td>
</tr>
</tbody>
</table>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xhr.<span class="property">onprogress</span> = <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(e.<span class="property">lengthComputable</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> p = e.<span class="property">loaded</span> / e.<span class="property">total</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="send-data-的参数"><a class="header-anchor" href="#send-data-的参数">¶</a><code>send(data)</code>的参数</h4>
<p><code>xhr.send(data)</code>的参数data可以是以下几种类型：</p>
<ul>
<li><code>ArrayBuffer</code></li>
<li><code>Blob</code></li>
<li><code>Document</code></li>
<li><code>DOMString</code></li>
<li><code>FormData</code></li>
<li><code>null</code></li>
</ul>
<p>data的值会影响请求头部<code>content-type</code>的默认值。</p>
<ul>
<li>如果<code>data</code>是 <code>Document</code> 类型，同时也是<code>HTML Document</code>类型，则<code>content-type</code>默认值为<code>text/html;charset=UTF-8</code>;否则为<code>application/xml;charset=UTF-8</code>；</li>
<li>如果<code>data</code>是 <code>DOMString</code> 类型，<code>content-type</code>默认值为<code>text/plain;charset=UTF-8</code>；</li>
<li>如果<code>data</code>是 <code>FormData</code> 类型，<code>content-type</code>默认值为<code>multipart/form-data; boundary=[xxx]</code></li>
<li>如果<code>data</code>是其他类型，则不会设置<code>content-type</code>的默认值</li>
</ul>
<h3 id="4-ajax和js单线程机制"><a class="header-anchor" href="#4-ajax和js单线程机制">¶</a>4.<code>ajax</code>和<code>js</code>单线程机制</h3>
<p>​		在说这个话题之前，需要先了解下<code>js</code>的单线程机制和浏览器的多线程机制：</p>
<p>​		<a href="http://www.ruanyifeng.com/blog/2014/10/event-loop.html">JavaScript 运行机制详解：再谈Event Loop</a></p>
<p>​       批注版:<a href="https://blog.csdn.net/lin_credible/article/details/40143961#commentBox">JavaScript 运行机制详解：再谈Event Loop</a></p>
<p>​		<em>这里没有黑阮老师的意思，阮老师翻译了很多优质的外文，他的本业是金融，对于计算机知识不够严谨，但对于科普，做简单的了解是足够的，并且阮老师也对博文内的错误做了修改。所以，我们也要明白，要想真正学到东西，还是要去看标准文档，比如<code>mdn web doc</code>，去看学校里的基础课程，任何人的二手知识，只能拿来参考，绝不能作为标准。</em></p>
<p>​		我们都知道，<code>javaScript</code>是一门单线程的语言，但是它运行的环境（这里☞的是浏览器）是多线程的。用当前最流行的<code>Chrome</code>浏览器作为例子。</p>
<p>有以下几个常驻线程：</p>
<ul>
<li>渲染引擎线程：顾名思义，该线程负责页面的渲染</li>
<li><code>JS</code>引擎线程：负责<code>JS</code>的解析和执行</li>
<li>定时触发器线程：处理定时事件，比如<code>setTimeout</code>, <code>setInterval</code></li>
<li>事件触发线程：处理<code>DOM</code>事件</li>
<li>异步<code>http</code>请求线程：处理<code>http</code>请求</li>
</ul>
<p>​        需要注意的是，渲染线程和<code>JS</code>引擎线程是不能同时进行的。渲染线程在执行任务的时候，<code>JS</code>引擎线程会被挂起。因为<code>JS</code>可以操作DOM，若在渲染中<code>JS</code>处理了DOM，浏览器可能就不知所措了。</p>
<p>另外一个需要提起的是浏览器实现异步的消息队列和事件循环</p>
<p>​	    浏览器有一个主线程用来执行代码，还有一些其他的线程执行比较耗时的操作，比如<code>http</code>请求，定时器等，所有的函数调用都在一个<code>stack</code>里面，主线程会依次执行这个<code>stack</code>里的代码，当遇到一个异步的操作时，异步线程执行异步操作，然后当异步执行完毕，会把回调函数作为一个任务加到一个<strong>消息队列</strong><code>queue</code>里面(实际上，有多个消息队列，这里为了说明做了简化)，浏览器不断的监听着<code>stack</code>，一旦<code>stack</code>被清空。就从队列里取出一个任务加到<code>stack</code>里面，然后主线程执行这个任务。</p>
<p>​		由于<code>js</code>引擎从消息队列里面读取事件任务时不间断的，只要<code>stack</code>清空，就会有新的任务加到里面，如果消息队列里没有任务，就会一直等待，这就是<strong>事件循环</strong><code>Event Loop</code>。</p>
<p>类似下面代码:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (queue.<span class="title function_">waitForMessage</span>()) &#123;</span><br><span class="line"> 		queue.<span class="title function_">processNextMessage</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里插播一道题：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>));</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>)</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">t</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(t));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>);</span><br></pre></td></tr></table></figure>
<p>答案是 <code>4，3，2，1</code></p>
<p>​	    具体的解释点这里<a href="https://github.com/dwqs/blog/issues/61">从一道题浅说 JavaScript 的事件循环</a>。</p>
<p>回归正传，</p>
<p>​		当发起一个<code>ajax</code>请求，调用<code>send</code>方法后，浏览器开启新的线程，发起网络请求，<code>js</code>主线程会继续向下执行，当当ajax请求被服务器响应并且收到response后, 浏览器事件触发线程捕获到了ajax的回调事件 <code>onreadystatechange</code> (当然也可能触发<code>onload</code>, 或者 <code>onerror</code>等等) . 该回调事件并没有被立即执行, 而是被添加到 <code>任务队列</code> 的末尾. 直到<code>js</code>引擎空闲了, <code>任务队列</code> 的任务才被捞出来, 按照添加顺序, 挨个执行, 当然也包括刚刚append到队列末尾的 <code>onreadystatechange</code> 事件。</p>
<h3 id="5-ajax和跨域"><a class="header-anchor" href="#5-ajax和跨域">¶</a>5.<code>ajax</code>和跨域</h3>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS">http访问控制</a></p>
<p>首先要了解什么是跨域，跨域就是因为浏览器的同源策略，造成的访问限制。</p>
<p>关于解决方案，看下文：</p>
<p>[<a href="https://segmentfault.com/a/1190000012469713">ajax跨域，这应该是最全的解决方案了</a>](<a href="https://segmentfault.com/a/1190000012469713">https://segmentfault.com/a/1190000012469713</a>)</p>
<h3 id="6-fetch-api"><a class="header-anchor" href="#6-fetch-api">¶</a>6.<code>fetch api</code></h3>
<p><code>Fetch API</code> 提供了一个获取资源的接口（包括跨域请求）。任何使用过 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest"><code>XMLHttpRequest</code></a> 的人都能轻松上手，但新的<code>API</code>提供了更强大和灵活的功能集。并且<code>fetch</code>支持<code>promise</code>语法。</p>
<p>关于promise点击<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise对象</a></p>
<p>关于<code>fetch</code>点击 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API">Fetch API</a></p>
<p><code>Fetch</code>有个缺点是不支持进度。</p>
<p>使用方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 简单例子</span></span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;http://example.com/movies.json&#x27;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> response.<span class="title function_">json</span>();</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">myJson</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(myJson);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 支持请求参数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">postData</span>(<span class="params">url, data</span>) &#123;</span><br><span class="line">  <span class="comment">// Default options are marked with *</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">fetch</span>(url, &#123;</span><br><span class="line">    <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data), <span class="comment">// must match &#x27;Content-Type&#x27; header</span></span><br><span class="line">    <span class="attr">cache</span>: <span class="string">&#x27;no-cache&#x27;</span>, <span class="comment">// *default, no-cache, reload, force-cache, only-if-cached</span></span><br><span class="line">    <span class="attr">credentials</span>: <span class="string">&#x27;same-origin&#x27;</span>, <span class="comment">// include, same-origin, *omit</span></span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;Mozilla/4.0 MDN Example&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>, <span class="comment">// *GET, POST, PUT, DELETE, etc.</span></span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;cors&#x27;</span>, <span class="comment">// no-cors, cors, *same-origin</span></span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&#x27;follow&#x27;</span>, <span class="comment">// manual, *follow, error</span></span><br><span class="line">    <span class="attr">referrer</span>: <span class="string">&#x27;no-referrer&#x27;</span>, <span class="comment">// *client, no-referrer</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>()) <span class="comment">// parses response to JSON</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认情况下，fetch 不会从服务端发送或接收任何 cookies,如果站点依赖于用户 session，则会导致未经认证的请求（要发送 cookies，必须设置 credentials 选项）</span></span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;https://example.com&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">credentials</span>: <span class="string">&#x27;include&#x27;</span>  </span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>tags</code>:要在不支持的浏览器中使用Fetch，可以使用<a href="https://github.com/github/fetch">Fetch Polyfill</a>。</p>
<h3 id="7-Axios使用"><a class="header-anchor" href="#7-Axios使用">¶</a>7.<code>Axios</code>使用</h3>
<p><code>Axios</code> 是一个基于 <code>promise</code> 的 <code>HTTP</code> 库，可以用在浏览器和 <code>node.js</code> 中。如果你不想为了简单的发送<code>ajax</code>	请求就要下载庞大的<code>jquery</code>,只有几kb大小的<code>axios</code>是很好的替代产品。</p>
<p>使用方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 执行get 请求</span></span><br><span class="line"><span class="comment">// 为给定 ID 的 user 创建请求</span></span><br><span class="line">axios.<span class="title function_">get</span>(<span class="string">&#x27;/user?ID=12345&#x27;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可选地，上面的请求可以这样做</span></span><br><span class="line">axios.<span class="title function_">get</span>(<span class="string">&#x27;/user&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">params</span>: &#123;</span><br><span class="line">      <span class="attr">ID</span>: <span class="number">12345</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行post</span></span><br><span class="line">axios.<span class="title function_">post</span>(<span class="string">&#x27;/user&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">firstName</span>: <span class="string">&#x27;Fred&#x27;</span>,</span><br><span class="line">    <span class="attr">lastName</span>: <span class="string">&#x27;Flintstone&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行多个并发请求</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getUserAccount</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> axios.<span class="title function_">get</span>(<span class="string">&#x27;/user/12345&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getUserPermissions</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> axios.<span class="title function_">get</span>(<span class="string">&#x27;/user/12345/permissions&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">axios.<span class="title function_">all</span>([<span class="title function_">getUserAccount</span>(), <span class="title function_">getUserPermissions</span>()])</span><br><span class="line">  .<span class="title function_">then</span>(axios.<span class="title function_">spread</span>(<span class="keyword">function</span> (<span class="params">acct, perms</span>) &#123;</span><br><span class="line">    <span class="comment">// 两个请求现在都执行完成</span></span><br><span class="line">  &#125;));</span><br></pre></td></tr></table></figure>

        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
    <!-- 使用 Gitalk -->
<div id="gitalk-comment">
    <!-- Gitalk 评论框 -->
<div id="gitalk-container"></div>

<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">

<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<script>
    var gitalk = new Gitalk({
            clientID: '7047f32466c59bed6274',
            clientSecret: '50030c1dc4654f2f10f8df23b3a084692a8ce248',
            repo: 'gitTalkBuck',
            owner: 'zzz1220',
            admin: ['zzz1220'],
            // facebook-like distraction free mode
            distractionFreeMode: false
        })
   gitalk.render('gitalk-container')
</script>
</div>
<style>
    #gitalk-comment {
        background-color: #eee;
        padding: 2pc;
    }
</style>

                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/posts/4ec38d83/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/posts/e08b183b/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>


<script>
    (function initVisibilitychange() {
        var title = document.title 
        var key
        document.addEventListener('visibilitychange', function() {
            if(document.visibilityState === 'visible') {
                document.title = "骗你的~~"
                key = setTimeout(() => {
                    document.title = title
                },1500)
            }else {
                clearTimeout(key)
                document.title = "糟糕~chrome崩溃了~~~"
            }
        })
    })()
    </script>

                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.jpg);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.jpeg" alt="zzz1220's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2023/11/">十一月 2023<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2023/10/">十月 2023<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2022/11/">十一月 2022<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/07/">七月 2021<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/05/">五月 2021<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/04/">四月 2021<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/12/">十二月 2020<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/07/">七月 2019<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/06/">六月 2019<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/05/">五月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/04/">四月 2019<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/07/">七月 2018<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/04/">四月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/03/">三月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/02/">二月 2018<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/01/">一月 2018<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/code/">code<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/categories/javaScript/">javaScript<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/tool/">tool<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
            <li class="divider"></li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/about" title="关于我">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                关于我
            </a>
        </li>
        
    
        <li>
            <a href="/tags" title="标签云">
                
                    <i class="material-icons sidebar-material-icons">label</i>
                
                标签云
            </a>
        </li>
        
    
        <li>
            <a href="/timeline" title="时间轴">
                
                    <i class="material-icons sidebar-material-icons">timeline</i>
                
                时间轴
            </a>
        </li>
        
    
        <li>
            <a href="/gallery" title="相册">
                
                    <i class="material-icons sidebar-material-icons">photo</i>
                
                相册
            </a>
        </li>
        
    
        <li>
            <a href="/books" title="书单">
                
                    <i class="material-icons sidebar-material-icons">books</i>
                
                书单
            </a>
        </li>
        
    
        <li>
            <a href="/movies" title="电影">
                
                    <i class="material-icons sidebar-material-icons">movie</i>
                
                电影
            </a>
        </li>
        
    
        <li>
            <a href="/games" title="游戏">
                
                    <i class="material-icons sidebar-material-icons">face</i>
                
                游戏
            </a>
        </li>
        
    
        <li>
            <a href="/links" title="链接">
                
                    <i class="material-icons sidebar-material-icons">linkify</i>
                
                链接
            </a>
        </li>
        
            <li class="divider"></li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                文章总数
                <span class="sidebar-badge">32</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar friend  -->
        <!-- 友链页面 -->

<style>
.mdl-card.sidebar-card_friend{
    padding: 20px;
    width:auto;
    overflow: hidden;
    padding-top: 10px;
}
.mdl-card.sidebar-card_friend h6{
    height: 28px;
    line-height: 28px;
    font-weight: 400;
    white-space: nowrap;
    text-decoration: none;
    text-align: center;
    font-size: 14px;
    font-family: Roboto, "Helvetica Neue";
    margin: 0 auto;
}
.mdl-card.sidebar-card_friend a{
    color: black;
    text-decoration-line: none;
    font-family: Roboto, "Helvetica Neue";
    width:fit-content;
    width:-webkit-fit-content;
    width:-moz-fit-content;
    white-space: nowrap;
    word-break: keep-all;
    margin: 8px 4px;
    font-size: 13px;
}
.mdl-card.sidebar-card_friend a:hover {
    color: #00838F;
}
.mdl-card.sidebar-card_friend a::before {
    content: "";
    position: absolute;
    width: 5px;
    height: 5px;
    border-radius: 50%;
    background-color: #00838F;
    left:-8px;
    top:8px;
}
#friend-content{
    display: flex;
    align-content: center;
    flex-wrap: wrap;
}
</style>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            主题 - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

    <a href="https://blog.viosey.com/index.php/Material.html" target="_blank" class="sidebar-footer-text-a">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
             sidebar.about_theme
            <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
    </a>

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/zzz1220" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    

    <!-- V2EX -->
    

    <!-- Segmentfault -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;<span year></span>&nbsp;simmyo_z的博客
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?wgjW/HuQG9JDgvPDPoRAng==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?zvSPHDkEskkA20yxZY14lg==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>



    
        <script>lsloader.load("sm_js","/js/smoothscroll.js?j10x2vnLBvyUc9TVmIDKCg==", true)</script>
    





    <!-- Busuanzi -->
    <script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



   <!-- GitTalk -->





<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->

    
        
            <script>lsloader.load("prettify_js","/js/prettify.min.js?WN07fivHQSMKWy7BmHBB6w==", true)</script>
        
    



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
        
            $(function() {
                $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
                prettyPrint();
                })
        
    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    var copyrightNow = new Date().getFullYear();
    var textContent = document.querySelector('span[year]')

    copyrightSince = 2017;
    if (copyrightSince === copyrightNow||copyrightSince === 0000) {
        textContent.textContent = copyrightNow
    } else {
        textContent.textContent = copyrightSince + ' - ' + copyrightNow
    }

    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.6 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
            <script id="dsq-count-scr" src="//zzz1220-1.disqus.com/count.js" async></script>
        <script>if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js?t=1699344494984')
    .then(function () {console.log('ServiceWorker Register Successfully.')})
    .catch(function (e) {console.error(e)});
}
</script></body>
    
</html>
