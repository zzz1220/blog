---
title: 代码新手容易犯的错误
tags:
  - 吐槽
abbrlink: 68922dda
date: 2019-04-18 20:26:02
---



> 怎么判断代码质量？答案是接手的人单位时间内骂脏话的频率，频率越高，代码质量越低。


### 无尽的if

 记得刚参加工作的时候，有幸见到了前同事留下的`python web`项目，从`svn`下载下来，刚用`vscode`打开就感觉一股王霸之气铺面而来，`.py`文件一行行`if`,`elif`构成了一条条精美的贝瑟尔曲线，`if`里面是`if`，再往里面还是`if`，一眼看不到尽头，当我要加个新的配置变量，这个请求都要翻过层层的`if`高山，跨过条条`elif`大海，最终才到达它应有的处理函数。更不要说在`python`里面直接拼接`html`代码了。说好的面向对象呢？说好的`mvc`呢？

终于，在排除这些判断条件不会造成影响后，我激动的提交请求，刷新页面，纳尼？怎么没效果呢？於是我打开chrome控制台，发现在某个引入的`js`文件里的不起眼的小角落，又是一层层的`if` `else`。。。

<img src="https://wxt.sinaimg.cn/mw1024/bca3c023gy1g2728tm7b2j20k00jyglx.jpg?tags=%5B%5D" width="20%" height="10%">

孤军奋战了一个月，逐步理清了大部分逻辑后，才慢慢消灭了一部分面条代码，后来呢，估计老板也受不了了，直接让重构了。

到处都是`if else`的代码就像一盘意大利面条，绕来绕去，理不清头绪，那么怎么合理利用`if`呢？好的`if`看起来是树状结构的，而不是n个不相干的`if`穿插另外一些`else`,好的结构就像下面,它们有可能嵌套，有多层的缩进,但是把逻辑却整理的清清楚楚。

```java
if (...) {
  if (...) {
    ...
  } else {
    ...
  }
} else if (...) {
  ...
} else {
  ...
}
```




那么，从这里可以得到什么结论呢？

1. 写合理的`if`结构代码，分支太多[可以用表驱动法消灭](https://baike.baidu.com/item/%E8%A1%A8%E9%A9%B1%E5%8A%A8%E6%B3%95/15768054?fr=aladdin)，比如用`map`储存对应的`condition`和`process`。然后就可以用这个map的key直接拿到要进行的操作了。
2. 大段复用代码抽象为函数。
3. `oo`语言要学会运用面向对象，对象的组合，继承来实现多态，这里需要有一定的抽象能力。

### 为同一功能编写不同的函数

这里有个很重要的`DRY`的原则，当产品一开始可能要求烹饪一只鱼，但是需求时时刻刻都在变化，后面可能又要油炸一块鸡排，如果一开始就写成`cookingFish`的函数，在第二次增加需求的时候，就要果断重构这个函数，可以把鱼当做函数传进去，而不是在copy一份代码写个`cookingChicken`的函数，当然最好一开始就写成`cooking`函数，不要特指处理的食材，这样才能在后面更好的扩展这个函数。

案例：

在工作过的地方，见到线上的代码有处理不同车型数据的函数，于是几乎逻辑一样的代码，出现了`processBmw`,`processBenz`,`processAudi`等等十几个函数，真的让人很无奈。

这个改进方案就很灵活了，可以把品牌作为参数传进去，或者用策略模式，对不同的品牌做不同的处理逻辑。



### 对复杂度和性能不敏感

经验丰富的程序员在编写每一行代码时都会有肌肉记忆，当在`for` 循环里面套`for`循环的时候就会意识到成指数上升的时间复杂度而去优化算法。经验不够丰富的一般凭感觉写代码，忽视复杂度，造成性能底下的代码。

这里一般情况下遇到性能瓶颈都可以去`review`代码,查看执行时间长的部分，优化过来。

但是还是要对性能敏感一点，每当写遍历，递归的时候，或者执行一个`io`操作的时候，多想想怎么提高性能。

案例：

线上代码，在验证客户提交的excel文件的时候，要验证每一行数据在配置文件里的规则是否合理，之前的同事写了个函数`check`，但是却把读取配置文件的步骤也写在这个函数里面，导致遍历客户上传的数据，每验证一行数据都要重新读取一下配置文件。

### 命名不清晰

这里提供一个好的命名方案

##### 有表现力的词

| 单词  | 更多选择                                           |
| ----- | -------------------------------------------------- |
| send  | deliver、dispatch、announce、distribute、route     |
| find  | search、extract、locate、recover                   |
| start | launch、create、begin、open                        |
| make  | create、set up、build、generate、compose、add、new |

##### 带单位的命名

| 参数或变量                    | 带单位的命名          |
| ----------------------------- | --------------------- |
| start(int delay)              | delay -> delaySecs    |
| createCache(int size)         | size -> sizeMB \|     |
| throttleDownload(float limit) | limit -> maxKB        |
| setHeight(float height)       | height -> heightCM \| |

##### 给名字附加额外信息

| 场景                                   | 变量名   | 更好的名字           |
| -------------------------------------- | -------- | -------------------- |
| 一个纯文本的密码，需要加密后才可以使用 | password | plaintextPassword \| |
| 一条用户评论，需要转义后显示           | comment  | unescapedComment     |
| 已转化为UTF-8的HTML文本                | html     | htmlUtf8             |
| 以"URL"方式编码的输入数据              | data     | dataURLEncode \|     |

### 不懂语言内置函数

这个就纯粹是经验问题了，不会用语言已经给的标准函数，偏偏自己写逻辑。但是，为啥我遇到那么多这样的代码，难道我接手的项目的都是编程小白写的？

举几个例子：

实现英文转换大小写，我看到是这样写的，定义了一个函数，接受一个字符串作为参数，遍历这个字符串，判断每个字符，如果是小写的`a`就转换为大写的`A`,依次类推，我无F可说了。

从数据库拿到数据后，自己有用冒泡排了顺序。是有多心疼数据库，舍不得让它多干一点事。

用`freemarker`做模板，输出`json`里面有特殊字符，遇到一个就`replace`一个，提交一次代码，就不能看下文档用`${string?JSON}`吗?

and so on...

![](https://wx1.sinaimg.cn/mw1024/bca3c023gy1g272av1q13j207905d749.jpg)



所以。平时没事可以多看看`api`，遇到问题先找找有木有内置的标准库或者函数。免得自己写，效率低还可能有bug。

### 计算机和网络基础薄弱

有个需求是判断`api`请求来源是自己的web产品端还是通过其他微服务接口,有个同事是这样写的，在自己的web端调用每个接口的时候都加了个`FLAG`参数，然后在服务端每个接口都判断下`FLAG`,emmmmm~不说啥了。

判断云服务接口端（http和mqtt协议）是否正常，不实现心跳接口，反而在自己的代码里去`ping`服务端，这里就是不懂网络架构，如果懂网络七层协议，就不会想当然的把能`ping`通当做服务正常了。

还有一些读完文件不释放资源的，不明白异步和同步，在同步的代码里各种`sleep`的。



关于这部分，如果是科班出身的，基础不牢固真的对不起自己在学校花费的时间和经历。

#### 先写到这儿吧。

*题外话*
说了这么多其实自己作为:chicken:时期也写了不少坑爹代码 :wink:，正所谓 问道有先后，一方面遇到这些代码要冷静，想想怎么改善一点点的重构，另一方面也要规范编码习惯和提升姿势水平，争取让自己的代码被别人读的时候，少说几句"wtf"。
















